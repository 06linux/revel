---
layout: godoc
---
<!--
	Copyright 2009 The Go Authors. All rights reserved.
	Use of this source code is governed by a BSD-style
	license that can be found in the LICENSE file.
-->
<h1>Server</h1>



	<pre>package rev

var (
    MainRouter         *Router
    MainTemplateLoader *TemplateLoader
    MainWatcher        *Watcher
)

<span class="comment">// Run the server.</span>
<span class="comment">// This is called from the generated main file.</span>
<span class="comment">// If port is non-zero, use that.  Else, read the port from app.conf.</span>
func Run(port int) {
    address := Config.StringDefault(&#34;http.addr&#34;, &#34;&#34;)
    if port == 0 {
        port = Config.IntDefault(&#34;http.port&#34;, 9000)
    }

    MainRouter = NewRouter(path.Join(BasePath, &#34;conf&#34;, &#34;routes&#34;))
    MainTemplateLoader = NewTemplateLoader(TemplatePaths)

    <span class="comment">// If desired (or by default), create a watcher for templates and routes.</span>
    <span class="comment">// The watcher calls Refresh() on things on the first request.</span>
    if Config.BoolDefault(&#34;server.watcher&#34;, true) {
        MainWatcher = NewWatcher()
        MainWatcher.Listen(MainTemplateLoader, MainTemplateLoader.paths...)
        MainWatcher.Listen(MainRouter, MainRouter.path)
    } else {
        <span class="comment">// Else, call refresh on them directly.</span>
        MainTemplateLoader.Refresh()
        MainRouter.Refresh()
    }

    server := &amp;http.Server{
        Addr:    fmt.Sprintf(&#34;%s:%d&#34;, address, port),
        Handler: http.HandlerFunc(handle),
    }

    plugins.OnAppStart()

    go func() {
        time.Sleep(100 * time.Millisecond)
        fmt.Printf(&#34;Listening on port %d...\n&#34;, port)
    }()

    ERROR.Fatalln(&#34;Failed to listen:&#34;, server.ListenAndServe())
}
</pre>






